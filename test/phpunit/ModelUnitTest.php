<?php

require_once(__DIR__ . '/../../vendor/autoload.php');

use sgoendoer\Sonic\Sonic;

use sgoendoer\Sonic\Crypt\KeyPair;
use sgoendoer\Sonic\Crypt\PublicKey;
use sgoendoer\Sonic\Crypt\PrivateKey;
use sgoendoer\Sonic\Crypt\Random;
use sgoendoer\Sonic\Crypt\Signature;
use sgoendoer\Sonic\Crypt\IUniqueIDManager;

use sgoendoer\Sonic\Date\XSDDateTime;

use sgoendoer\Sonic\Identity\UOID;
use sgoendoer\Sonic\Identity\GID;
use sgoendoer\Sonic\Identity\GSLS;
use sgoendoer\Sonic\Identity\SocialRecord;
use sgoendoer\Sonic\Identity\SocialRecordBuilder;
use sgoendoer\Sonic\Identity\SocialRecordManager;
use sgoendoer\Sonic\Identity\KeyRevocationCertificate;
use sgoendoer\Sonic\Identity\KeyRevocationCertificateBuilder;
use sgoendoer\Sonic\Identity\ISocialRecordCaching;

use sgoendoer\Sonic\Request\Request;

use sgoendoer\Sonic\Model\CommentObjectBuilder;
use sgoendoer\Sonic\Model\PersonObjectBuilder;
use sgoendoer\Sonic\Model\ProfileObjectBuilder;
use sgoendoer\Sonic\Model\ConversationObjectBuilder;
use sgoendoer\Sonic\Model\ConversationStatusObjectBuilder;
use sgoendoer\Sonic\Model\ConversationStatusObject;
use sgoendoer\Sonic\Model\ConversationMessageObjectBuilder;
use sgoendoer\Sonic\Model\ConversationMessageStatusObject;
use sgoendoer\Sonic\Model\ConversationMessageStatusObjectBuilder;
use sgoendoer\Sonic\Model\LikeObjectBuilder;
use sgoendoer\Sonic\Model\LinkObjectBuilder;
use sgoendoer\Sonic\Model\LinkRequestObjectBuilder;
use sgoendoer\Sonic\Model\LinkResponseObjectBuilder;
use sgoendoer\Sonic\Model\LinkRosterObjectBuilder;
use sgoendoer\Sonic\Model\StreamItemObjectBuilder;
use sgoendoer\Sonic\Model\TagObjectBuilder;
use sgoendoer\Sonic\Model\ResponseObjectBuilder;

date_default_timezone_set('Europe/Berlin');

class ModelUnitTest extends PHPUnit_Framework_TestCase
{
	public $aliceSRjson = '{"socialRecord":{"@context":"http://sonic-project.net/","@type":"socialrecord","type":"user","globalID":"4802C8DE6UZZ5BICQI830A8P8BW3YB5EBPGXWNRH1EP7H838V7","platformGID":"2UZCAI2GM45T160MDN44OIQ8GKN5GGCKO96LC9ZOQCAEVAURA8","displayName":"Alice","profileLocation":"http://social.snet.tu-berlin.de/sonic-sdk/","personalPublicKey":"-----BEGIN PUBLIC KEY-----MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAzMp0mukaLQl2Ya0RmZKtioXx3gifTe6Bu2UUsrOgwd/SHB3g438pcJBqF8pvPKKhx0hgp8MX1W3IGyqsNsIbFF2b4r9VrtDqUUd0WBCKsvBNcqxfqWkez2kVB+Q3hQkOjyocuO8I6v1rvkFNsio0E9XLPcLOiYJL3qHrbQFI+qtshfgjeK9taZbrEX6uY4VQ602fb8dHK9ieCV/W46RCTQS4+ac1+y1CAyH7gQ5TPMZ2vraeLR4kA1r8l/u3ZhB8b8biMt81K/WVcEf+8K4LAi/Tub1uDowKU2HNveG5ov055hvbvYv/9z1kEFGpTEMOzl0hiK4DGkvpugVO9nUfyy7VA85ZgkBpY4WoHGoZQbubyBsMwqpmT1pkUwAQTKnv6ME1YLLY81YjeshQz+YezT/gqH0uC3a+ZcQotFanNyTvQrtjxQSqeOA87K1RwfJvn9QS4Lz3MMt8eSK1/H+aFavDBARgzAGPgDRBTtjKSvdImZ1g5zd9pItzGV9ZcasvTY3/m6U5L9ByiiFEHLQJr9eKBb0OAoQVG9G5vYQ1f1CF7OtYQA2L0ygc4TwwLCjILBJDoqiOuYgq/wVzE1200G1tQ504hLdaUJIETCLxvDhyMI3TbywxLSyihYjC3Tge68X+rKPgZoY4ahTok0CszOzYf4lDsYmKAPIVDH5C5AECAwEAAQ==-----END PUBLIC KEY-----","accountPublicKey":"-----BEGIN PUBLIC KEY-----MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAvgeptoYIVDvxPPIk4ZBpRy/SohpJPTHSguP3VjWG0xL8zllZSkdBLS1ijBGCxG/jx5KebBSLSkIAjEdby0/FKRjLTBqC7eak6s/1zUUzoABXwu/JckAToOJK5R/iSwAd5jOa94Bl6q7Pu6kfBsDSg43JOkIU0rvfMNcgdo/9GJwI2tg6/ZjM5YWNoRcHvl2XXM0lljJrxfVlXpWNhTUUoy/IrnyPhBlhHCXtbCVo/U5gQ5O6ymqwewRyWwhfvaWrWiwAW6KnvBz3ddCmjBArerOciVtcSXRoJ01jQP4HeDTzQDxvDb4ymAewfoRuzp0ctL4tMMS8P+XxpQmNrivZP+thwEM+jB8XLkbFB1Pj0aTdQzCkrJupiSz8mK5aBBptjPsek50egoOEyf5LY3y/daup5rbLFLE58pNO13GdtDiin0NDVwrC19uKrvy5vca/+O1lZjTaVNrP9FN9ug2wZ62N7Q6vyZT0H+7wkdbGWeKhxMa1j05dx0v61dp91k6N4wWXEeAknLw06FrCKicKjA6LQIVrT9KYjWDI9ewwaoKbRyrKJrHNoZg1+Mua+x3TWsXAEGE91+Mgdd0UZQ+XBihjyq76ccZULbzJ/flGeOyVUMwXg05QNT6zXRDyNUPUyb8HoI0kHlT8nRDF9kkKu2Yx40EhsrAQogoEqgxeYoUCAwEAAQ==-----END PUBLIC KEY-----","salt":"abb0afd289f102f3","datetime":"2016-01-13T10:58:54+01:00","active":1,"keyRevocationList":[]},"accountPrivateKey":"-----BEGIN PRIVATE KEY-----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-----END PRIVATE KEY-----","personalPrivateKey":"-----BEGIN PRIVATE KEY-----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-----END PRIVATE KEY-----"}';
	
	public $aliceSR = NULL;
	public $aliceSocialRecord = NULL;
	public $aliceAccountKeyPair = NULL;
	public $alicePersonalKeyPair = NULL;
	
	public $bobSR = NULL;
	public $bobSocialRecord = NULL;
	public $bobAccountKeyPair = NULL;
	public $bobPersonalKeyPair = NULL;
	
	public function __construct()
	{
		$this->aliceSR = SocialRecordManager::importSocialRecord($aliceSRjson);
		$this->aliceSocialRecord = $this->aliceSR['socialRecord'];
		$this->aliceAccountKeyPair = $this->aliceSR['accountKeyPair'];
		$this->alicePersonalKeyPair = $this->aliceSR['personalKeyPair'];
		
		$this->bobSR = SocialRecordManager::importSocialRecord($bobSRjson);
		$this->bobSocialRecord = $this->bobSR['socialRecord'];
		$this->bobAccountKeyPair = $this->bobSR['accountKeyPair'];
		$this->bobPersonalKeyPair = $this->bobSR['personalKeyPair'];
	}
	
	public function testProfile()
	{
		$profile = (new ProfileBuilder())
					->globalID($this->aliceSR->getGlobalID())
					->displayName($this->aliceSR->getDisplayName())
					->param('x', 'y')
					->build();
		
		$profile->validateJSON($profile->getJSONString());
		
		$this->assertEquals($profile, ProfileObjectBuilder::buildFromJSON($profile->getJSONString()));
	}
}

?>